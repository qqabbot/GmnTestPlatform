import{r as O}from"./request-c7ccb34d.js";import{e as R}from"./environment-a944f101.js";import{l as L}from"./MonacoEditor.vue_vue_type_style_index_0_scoped_fcb97235_lang-9aa76e92.js";import{i as Q,s as N,l as M,z as X,n as b,v as C,q as k,A as H,r as _,a as q,o as S,f as V,d as E,D as Y,aT as Z,b as j,ab as ee,C as T,w as U,bc as te,aS as ae,au as le,aP as re,F as ne,aR as oe,g as x,t as B}from"./index-8b1ce721.js";const Ue={getAll(e){return O({url:"/step-templates",method:"get",params:e})},create(e){return O({url:"/step-templates",method:"post",data:e})},update(e,t){return O({url:`/step-templates/${e}`,method:"put",data:t})},delete(e){return O({url:`/step-templates/${e}`,method:"delete"})}};var se=Object.defineProperty,ue=Object.defineProperties,ie=Object.getOwnPropertyDescriptors,z=Object.getOwnPropertySymbols,de=Object.prototype.hasOwnProperty,ce=Object.prototype.propertyIsEnumerable,A=(e,t,a)=>t in e?se(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,$=(e,t)=>{for(var a in t||(t={}))de.call(t,a)&&A(e,a,t[a]);if(z)for(var a of z(t))ce.call(t,a)&&A(e,a,t[a]);return e},ve=(e,t)=>ue(e,ie(t));const P={wrapper:{display:"flex",position:"relative",textAlign:"initial"},fullWidth:{width:"100%"},hide:{display:"none"}};function pe(e,t){const a=M(()=>{const{width:l,height:c}=e;return ve($({},P.wrapper),{width:l,height:c})}),o=M(()=>$($({},P.fullWidth),!t.value&&P.hide));return{wrapperStyle:a,containerStyle:o}}function fe(){const e=N(L.__getMonacoInstance()),t=_(!1);let a;return k(()=>{e.value||(a=L.init(),a.then(l=>e.value=l).catch(l=>{(l==null?void 0:l.type)!=="cancelation"&&(t.value=!0,console.error("Monaco initialization error:",l))}))}),{monacoRef:e,unload:()=>a==null?void 0:a.cancel(),isLoadFailed:t}}function F(e){return typeof e=="function"?e():e}function I(e){return e===void 0}function J(e,t,a,o){return me(e,o)||ge(e,t,a,o)}function me(e,t){return e.editor.getModel(G(e,t))}function ge(e,t,a,o){return e.editor.createModel(t,a,o?G(e,o):void 0)}function G(e,t){return e.Uri.parse(t)}var he=Object.defineProperty,D=Object.getOwnPropertySymbols,_e=Object.prototype.hasOwnProperty,ye=Object.prototype.propertyIsEnumerable,W=(e,t,a)=>t in e?he(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,be=(e,t)=>{for(var a in t||(t={}))_e.call(t,a)&&W(e,a,t[a]);if(D)for(var a of D(t))ye.call(t,a)&&W(e,a,t[a]);return e};const Se={display:"flex",height:"100%",width:"100%",justifyContent:"center",alignItems:"center"};var Ve=Q({name:"VueMonacoEditor",model:{prop:"value",event:"update:value"},props:{defaultValue:String,defaultPath:String,defaultLanguage:String,value:String,language:String,path:String,theme:{type:String,default:"vs"},line:Number,options:{type:Object,default:()=>({})},overrideServices:{type:Object,default:()=>({})},saveViewState:{type:Boolean,default:!0},width:{type:[Number,String],default:"100%"},height:{type:[Number,String],default:"100%"},className:String},emits:["update:value","beforeMount","mount","change","validate"],setup(e,t){const a=new Map,o=N(null),{monacoRef:l,unload:c,isLoadFailed:m}=fe(),{editorRef:s}=Me(t,e,l,o),{disposeValidator:p}=we(t,e,l,s),i=M(()=>!!l.value&&!!s.value),{wrapperStyle:d,containerStyle:y}=pe(e,i);return X(()=>{var u,r;(u=p.value)==null||u.call(p),s.value?((r=s.value.getModel())==null||r.dispose(),s.value.dispose()):c()}),b([()=>e.path,()=>e.value,()=>e.language,()=>e.line],([u,r,n,v],[g,f,h,w])=>{if(i.value){if(u!==g){const K=J(l.value,r||e.defaultValue||"",n||e.defaultLanguage||"",u||e.defaultPath||"");e.saveViewState&&a.set(g,s.value.saveViewState()),s.value.setModel(K),e.saveViewState&&s.value.restoreViewState(a.get(u)),I(v)||s.value.revealLine(v);return}s.value.getValue()!==r&&s.value.setValue(r),n!==h&&l.value.editor.setModelLanguage(s.value.getModel(),n),!I(v)&&v!==w&&s.value.revealLine(v)}}),b(()=>e.options,u=>s.value&&s.value.updateOptions(u),{deep:!0}),b(()=>e.theme,u=>l.value&&l.value.editor.setTheme(u)),{containerRef:o,isEditorReady:i,isLoadFailed:m,wrapperStyle:d,containerStyle:y}},render(){const{$slots:e,isEditorReady:t,isLoadFailed:a,wrapperStyle:o,containerStyle:l,className:c}=this;return C("div",{style:o},[!t&&C("div",{style:Se},a?e.failure?F(e.failure):"load failed":e.default?F(e.default):"loading..."),C("div",{ref:"containerRef",key:"monaco_editor_container",style:l,class:c})])}});function Me({emit:e},t,a,o){const l=N(null);k(()=>{const m=b(a,()=>{o.value&&a.value&&(H(()=>m()),c())},{immediate:!0})});function c(){var m;if(!o.value||!a.value||l.value)return;e("beforeMount",a.value);const s=t.path||t.defaultPath,p=J(a.value,t.value||t.defaultValue||"",t.language||t.defaultLanguage||"",s||"");l.value=a.value.editor.create(o.value,be({model:p,theme:t.theme,automaticLayout:!0,autoIndent:"brackets",formatOnPaste:!0,formatOnType:!0},t.options),t.overrideServices),(m=l.value)==null||m.onDidChangeModelContent(i=>{const d=l.value.getValue();d!==t.value&&(e("update:value",d),e("change",d,i))}),l.value&&!I(t.line)&&l.value.revealLine(t.line),e("mount",l.value,a.value)}return{editorRef:l}}function we({emit:e},t,a,o){const l=_(null),c=b([a,o],()=>{if(a.value&&o.value){H(()=>c());const m=a.value.editor.onDidChangeMarkers(s=>{var p,i;const d=(i=(p=o.value)==null?void 0:p.getModel())==null?void 0:i.uri;if(d&&s.find(u=>u.path===d.path)){const u=a.value.editor.getModelMarkers({resource:d});e("validate",u)}});l.value=()=>m==null?void 0:m.dispose()}});return{disposeValidator:l}}const Oe={__name:"MonacoEditor",props:{modelValue:{type:String,default:""},language:{type:String,default:"json"},height:{type:String,default:"300px"},readOnly:{type:Boolean,default:!1},theme:{type:String,default:"vs-dark"}},emits:["update:modelValue","change"],setup(e,{emit:t}){const a=e,o=t,l=M({get:()=>a.modelValue,set:p=>{o("update:modelValue",p),o("change",p)}}),c=M(()=>a.theme),m=M(()=>({automaticLayout:!0,formatOnType:!0,formatOnPaste:!0,readOnly:a.readOnly,minimap:{enabled:!1},scrollBeyondLastLine:!1,fontSize:14,tabSize:2,theme:a.theme})),s=async(p,i)=>{if(i.editor.defineTheme("gmn-dark",{base:"vs-dark",inherit:!0,rules:[{token:"variable",foreground:"4ec9b0",fontStyle:"bold"}],colors:{}}),!window.__gmn_completion_registered){window.__gmn_completion_registered=!0;let d=[];try{const u=await R.getAll();d.push({label:"base_url",insertText:"${base_url}",detail:"Global Variable"}),d.push({label:"timestamp",insertText:"${timestamp}",detail:"Built-in"}),u.forEach(r=>{if(r.variables)try{const n=JSON.parse(r.variables);Object.keys(n).forEach(v=>{d.find(g=>g.label===v)||d.push({label:v,insertText:"${"+v+"}",detail:`Env: ${r.envName}`,kind:i.languages.CompletionItemKind.Variable})})}catch{}})}catch(u){console.warn("Failed to fetch variables for Monaco",u)}const y=(u,r)=>{const n=u.getWordUntilPosition(r),v={startLineNumber:r.lineNumber,endLineNumber:r.lineNumber,startColumn:n.startColumn,endColumn:n.endColumn};return u.getLineContent(r.lineNumber).substring(0,r.column-1),{suggestions:d.map(f=>({...f,range:v}))}};i.languages.registerCompletionItemProvider("json",{triggerCharacters:["$"],provideCompletionItems:y}),i.languages.registerCompletionItemProvider("groovy",{triggerCharacters:["$"],provideCompletionItems:y})}};return(p,i)=>(S(),V("div",{class:"monaco-editor-container",style:Z({height:e.height})},[E(Y(Ve),{value:l.value,"onUpdate:value":i[0]||(i[0]=d=>l.value=d),language:e.language,theme:c.value,options:m.value,onMount:s},null,8,["value","language","theme","options"])],4))}},xe=q(Oe,[["__scopeId","data-v-fcb97235"]]);const Ce={key:0,class:"suggestion-list"},$e=["onClick","onMouseover"],Pe={class:"var-name"},Ee={class:"var-value"},Ie={key:1,class:"empty-suggestions"},Ne={__name:"VariableInput",props:{modelValue:{type:[String,Number],default:""}},emits:["update:modelValue"],setup(e,{emit:t}){const a=e,o=t,l=_(a.modelValue),c=_(!1),m=_(null),s=_(null),p=_([]),i=_(0),d=_([]);b(()=>a.modelValue,r=>{l.value=r}),b(l,r=>{o("update:modelValue",r)}),k(async()=>{try{const r=await R.getAll(),n=[];n.push({name:"base_url",value:"Base URL"}),n.push({name:"timestamp",value:"Current Timestamp"}),r.forEach(v=>{if(v.variables)try{const g=JSON.parse(v.variables);Object.keys(g).forEach(f=>{n.find(h=>h.name===f)||n.push({name:f,value:g[f]||"",source:v.envName})})}catch{}}),d.value=n}catch(r){console.error("Failed to load variables for autocomplete",r)}});const y=r=>{if(r&&r.endsWith("$"))p.value=d.value,c.value=!0,i.value=0;else if(c.value){const n=r.slice(-1);(n===" "||n==="}")&&(c.value=!1)}},u=r=>{const n=l.value;n.endsWith("$")?l.value=n.substring(0,n.length-1)+"${"+r.name+"}":l.value+="${"+r.name+"}",c.value=!1};return(r,n)=>{const v=j("el-input"),g=j("el-popover");return S(),V("div",{class:"variable-input-wrapper",ref_key:"wrapperRef",ref:s},[E(v,re(r.$attrs,{modelValue:l.value,"onUpdate:modelValue":n[0]||(n[0]=f=>l.value=f),onInput:y,ref_key:"inputRef",ref:m}),ee({_:2},[T(r.$slots,(f,h)=>({name:h,fn:U(w=>[te(r.$slots,h,ae(le(w)),void 0,!0)])}))]),1040,["modelValue"]),E(g,{visible:c.value,"onUpdate:visible":n[1]||(n[1]=f=>c.value=f),"virtual-ref":m.value,trigger:"manual",placement:"bottom-start",width:"300","popper-class":"variable-popover"},{default:U(()=>[p.value.length>0?(S(),V("div",Ce,[(S(!0),V(ne,null,T(p.value,(f,h)=>(S(),V("div",{key:h,class:oe(["suggestion-item",{active:i.value===h}]),onClick:w=>u(f),onMouseover:w=>i.value=h},[x("span",Pe,B(f.name),1),x("span",Ee,B(f.value),1)],42,$e))),128))])):(S(),V("div",Ie,"No variables found"))]),_:1},8,["visible","virtual-ref"])],512)}}},Be=q(Ne,[["__scopeId","data-v-9455950c"]]);export{xe as M,Be as V,Ue as s};
