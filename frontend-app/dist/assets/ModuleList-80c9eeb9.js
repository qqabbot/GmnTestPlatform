import{t as y}from"./testModule-cc6cccac.js";import{p as W}from"./project-b5d312e0.js";import{a as J,r,l as Q,q as R,b as d,B as X,o as i,f as j,d as l,w as o,E as u,g as M,e as g,F as I,C as P,G as Y,c as x,t as Z,H as ee}from"./index-8b1ce721.js";import"./request-c7ccb34d.js";const le={class:"module-list"},te={class:"card-header"},oe={class:"filter-section"},ae={__name:"ModuleList",setup(de){const w=r(!1),s=r(!1),p=r(""),_=r(null),V=r([]),b=r([]),n=r({moduleName:"",projectId:null}),A=Q(()=>{let a=V.value;return _.value&&(a=a.filter(e=>e.project&&e.project.id===_.value)),p.value&&(a=a.filter(e=>e.moduleName.toLowerCase().includes(p.value.toLowerCase()))),a}),B=async()=>{try{b.value=await W.getAll()}catch{u.error("Failed to load projects")}},v=async()=>{w.value=!0;try{V.value=await y.getAll()}catch{u.error("Failed to load modules")}finally{w.value=!1}},F=a=>{n.value={...a,projectId:a.project?a.project.id:null},s.value=!0},D=async()=>{try{if(!n.value.moduleName){u.warning("Please enter module name");return}if(!n.value.projectId){u.warning("Please select a project");return}const a={...n.value,project:{id:n.value.projectId}};n.value.id?(await y.update(n.value.id,a),u.success("Module updated")):(await y.create(a),u.success("Module created")),s.value=!1,v()}catch{u.error("Failed to save module")}},E=async a=>{try{await ee.confirm("Are you sure to delete this module?","Warning",{confirmButtonText:"OK",cancelButtonText:"Cancel",type:"warning"}),await y.delete(a),u.success("Module deleted"),v()}catch(e){e!=="cancel"&&u.error("Failed to delete module")}},L=()=>{n.value={moduleName:"",projectId:null}};return R(()=>{B(),v()}),(a,e)=>{const S=d("Plus"),f=d("el-icon"),c=d("el-button"),C=d("el-option"),N=d("el-select"),T=d("Search"),h=d("el-input"),m=d("el-table-column"),U=d("Edit"),$=d("Delete"),z=d("el-table"),q=d("el-card"),k=d("el-form-item"),G=d("el-form"),H=d("el-dialog"),K=X("loading");return i(),j("div",le,[l(q,{class:"box-card"},{header:o(()=>[M("div",te,[e[8]||(e[8]=M("span",null,"Test Modules",-1)),l(c,{type:"primary",onClick:e[0]||(e[0]=t=>s.value=!0)},{default:o(()=>[l(f,null,{default:o(()=>[l(S)]),_:1}),e[7]||(e[7]=g(" New Module ",-1))]),_:1})])]),default:o(()=>[M("div",oe,[l(N,{modelValue:_.value,"onUpdate:modelValue":e[1]||(e[1]=t=>_.value=t),placeholder:"Filter by Project",style:{width:"200px","margin-right":"10px"},clearable:"",onChange:v},{default:o(()=>[(i(!0),j(I,null,P(b.value,t=>(i(),x(C,{key:t.id,label:t.projectName,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),l(h,{modelValue:p.value,"onUpdate:modelValue":e[2]||(e[2]=t=>p.value=t),placeholder:"Search modules...",style:{width:"300px"},clearable:""},{prefix:o(()=>[l(f,null,{default:o(()=>[l(T)]),_:1})]),_:1},8,["modelValue"])]),Y((i(),x(z,{data:A.value,style:{width:"100%","margin-top":"20px"}},{default:o(()=>[l(m,{prop:"id",label:"ID",width:"80"}),l(m,{prop:"moduleName",label:"Module Name","min-width":"200"}),l(m,{label:"Project","min-width":"200"},{default:o(({row:t})=>[g(Z(t.project?t.project.projectName:"-"),1)]),_:1}),l(m,{prop:"createdAt",label:"Created At",width:"180"}),l(m,{label:"Actions",width:"150",fixed:"right"},{default:o(({row:t})=>[l(c,{type:"primary",size:"small",text:"",onClick:O=>F(t)},{default:o(()=>[l(f,null,{default:o(()=>[l(U)]),_:1})]),_:1},8,["onClick"]),l(c,{type:"danger",size:"small",text:"",onClick:O=>E(t.id)},{default:o(()=>[l(f,null,{default:o(()=>[l($)]),_:1})]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[K,w.value]])]),_:1}),l(H,{modelValue:s.value,"onUpdate:modelValue":e[6]||(e[6]=t=>s.value=t),title:n.value.id?"Edit Module":"New Module",width:"600px",onClose:L},{footer:o(()=>[l(c,{onClick:e[5]||(e[5]=t=>s.value=!1)},{default:o(()=>[...e[9]||(e[9]=[g("Cancel",-1)])]),_:1}),l(c,{type:"primary",onClick:D},{default:o(()=>[...e[10]||(e[10]=[g("Save",-1)])]),_:1})]),default:o(()=>[l(G,{model:n.value,"label-width":"120px"},{default:o(()=>[l(k,{label:"Module Name"},{default:o(()=>[l(h,{modelValue:n.value.moduleName,"onUpdate:modelValue":e[3]||(e[3]=t=>n.value.moduleName=t)},null,8,["modelValue"])]),_:1}),l(k,{label:"Project"},{default:o(()=>[l(N,{modelValue:n.value.projectId,"onUpdate:modelValue":e[4]||(e[4]=t=>n.value.projectId=t),placeholder:"Select Project",style:{width:"100%"}},{default:o(()=>[(i(!0),j(I,null,P(b.value,t=>(i(),x(C,{key:t.id,label:t.projectName,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},ie=J(ae,[["__scopeId","data-v-87d2a3c7"]]);export{ie as default};
