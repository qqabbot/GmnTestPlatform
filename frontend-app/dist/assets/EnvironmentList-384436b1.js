import{a as X,r as u,q as Y,b as o,B as Z,o as b,f as ee,d as e,w as a,E as r,g as w,G as P,c as C,bS as le,t as ae,e as V,H as te}from"./index-8b1ce721.js";import{e as B}from"./environment-a944f101.js";import{r as F}from"./request-c7ccb34d.js";const $={getByEnvironment(m){return F.get(`/variables/environment/${m}`)},create(m){return F.post("/variables",m)},delete(m){return F.delete(`/variables/${m}`)}};const ne={class:"environment-list"},oe={class:"card-header"},re={class:"card-header"},ie={__name:"EnvironmentList",setup(m){const k=u(!1),E=u(!1),h=u([]),N=u([]),s=u(null),c=u(!1),p=u(!1),i=u({envName:"",domain:"",description:""}),d=u({keyName:"",valueContent:""}),x=async()=>{k.value=!0;try{h.value=await B.getAll()}catch{r.error("Failed to load environments")}finally{k.value=!1}},G=async n=>{n&&(s.value=n,D(n.id))},D=async n=>{E.value=!0;try{N.value=await $.getByEnvironment(n)}catch{r.error("Failed to load variables")}finally{E.value=!1}},H=async()=>{if(!i.value.envName)return r.warning("Name is required");try{await B.create(i.value),r.success("Environment created"),c.value=!1,x()}catch{r.error("Failed to create environment")}},I=async n=>{try{await te.confirm("Delete this environment?","Warning",{type:"warning"}),await B.delete(n),r.success("Environment deleted"),s.value&&s.value.id===n&&(s.value=null,N.value=[]),x()}catch(l){l!=="cancel"&&r.error("Failed to delete environment")}},Q=async()=>{if(!d.value.keyName||!d.value.valueContent)return r.warning("Key and Value are required");try{await $.create({...d.value,environment:{id:s.value.id}}),r.success("Variable created"),p.value=!1,D(s.value.id)}catch{r.error("Failed to create variable")}},T=async n=>{try{await $.delete(n),r.success("Variable deleted"),D(s.value.id)}catch{r.error("Failed to delete variable")}},W=()=>{i.value={envName:"",domain:"",description:""}},j=()=>{d.value={keyName:"",valueContent:""}};return Y(()=>{x()}),(n,l)=>{const q=o("Plus"),g=o("el-icon"),v=o("el-button"),_=o("el-table-column"),A=o("Delete"),U=o("el-table"),S=o("el-card"),z=o("el-col"),J=o("el-empty"),O=o("el-row"),f=o("el-input"),y=o("el-form-item"),L=o("el-form"),M=o("el-dialog"),K=Z("loading");return b(),ee("div",ne,[e(O,{gutter:20},{default:a(()=>[e(z,{span:8},{default:a(()=>[e(S,{class:"box-card"},{header:a(()=>[w("div",oe,[l[11]||(l[11]=w("span",null,"Environments",-1)),e(v,{type:"primary",size:"small",onClick:l[0]||(l[0]=t=>c.value=!0)},{default:a(()=>[e(g,null,{default:a(()=>[e(q)]),_:1})]),_:1})])]),default:a(()=>[P((b(),C(U,{data:h.value,"highlight-current-row":"",onCurrentChange:G,style:{width:"100%"}},{default:a(()=>[e(_,{prop:"envName",label:"Name"}),e(_,{label:"Actions",width:"100",align:"right"},{default:a(({row:t})=>[e(v,{type:"danger",size:"small",circle:"",text:"",onClick:le(R=>I(t.id),["stop"])},{default:a(()=>[e(g,null,{default:a(()=>[e(A)]),_:1})]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[K,k.value]])]),_:1})]),_:1}),e(z,{span:16},{default:a(()=>[s.value?(b(),C(S,{key:0,class:"box-card"},{header:a(()=>[w("div",re,[w("span",null,"Variables for "+ae(s.value.envName),1),e(v,{type:"primary",size:"small",onClick:l[1]||(l[1]=t=>p.value=!0)},{default:a(()=>[e(g,null,{default:a(()=>[e(q)]),_:1}),l[12]||(l[12]=V(" Add Variable ",-1))]),_:1})])]),default:a(()=>[P((b(),C(U,{data:N.value,style:{width:"100%"}},{default:a(()=>[e(_,{prop:"keyName",label:"Key",width:"180"}),e(_,{prop:"valueContent",label:"Value"}),e(_,{label:"Actions",width:"80",align:"right"},{default:a(({row:t})=>[e(v,{type:"danger",size:"small",circle:"",text:"",onClick:R=>T(t.id)},{default:a(()=>[e(g,null,{default:a(()=>[e(A)]),_:1})]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[K,E.value]])]),_:1})):(b(),C(J,{key:1,description:"Select an environment to view variables"}))]),_:1})]),_:1}),e(M,{modelValue:c.value,"onUpdate:modelValue":l[6]||(l[6]=t=>c.value=t),title:"New Environment",width:"400px",onClose:W},{footer:a(()=>[e(v,{onClick:l[5]||(l[5]=t=>c.value=!1)},{default:a(()=>[...l[13]||(l[13]=[V("Cancel",-1)])]),_:1}),e(v,{type:"primary",onClick:H},{default:a(()=>[...l[14]||(l[14]=[V("Save",-1)])]),_:1})]),default:a(()=>[e(L,{model:i.value,"label-width":"80px"},{default:a(()=>[e(y,{label:"Name",required:""},{default:a(()=>[e(f,{modelValue:i.value.envName,"onUpdate:modelValue":l[2]||(l[2]=t=>i.value.envName=t),placeholder:"e.g., QA, Prod"},null,8,["modelValue"])]),_:1}),e(y,{label:"Domain"},{default:a(()=>[e(f,{modelValue:i.value.domain,"onUpdate:modelValue":l[3]||(l[3]=t=>i.value.domain=t),placeholder:"e.g., http://api.example.com"},null,8,["modelValue"])]),_:1}),e(y,{label:"Desc"},{default:a(()=>[e(f,{modelValue:i.value.description,"onUpdate:modelValue":l[4]||(l[4]=t=>i.value.description=t),type:"textarea"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),e(M,{modelValue:p.value,"onUpdate:modelValue":l[10]||(l[10]=t=>p.value=t),title:"New Variable",width:"400px",onClose:j},{footer:a(()=>[e(v,{onClick:l[9]||(l[9]=t=>p.value=!1)},{default:a(()=>[...l[15]||(l[15]=[V("Cancel",-1)])]),_:1}),e(v,{type:"primary",onClick:Q},{default:a(()=>[...l[16]||(l[16]=[V("Save",-1)])]),_:1})]),default:a(()=>[e(L,{model:d.value,"label-width":"80px"},{default:a(()=>[e(y,{label:"Key",required:""},{default:a(()=>[e(f,{modelValue:d.value.keyName,"onUpdate:modelValue":l[7]||(l[7]=t=>d.value.keyName=t),placeholder:"e.g., base_url"},null,8,["modelValue"])]),_:1}),e(y,{label:"Value",required:""},{default:a(()=>[e(f,{modelValue:d.value.valueContent,"onUpdate:modelValue":l[8]||(l[8]=t=>d.value.valueContent=t),placeholder:"Variable value"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},ve=X(ie,[["__scopeId","data-v-daa136f5"]]);export{ve as default};
